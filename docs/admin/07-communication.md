# 커뮤니케이션 (Communication)

## 개요
사용자와의 이메일, 메시지, 알림 등 다양한 커뮤니케이션 채널을 관리합니다.

## 관련 테이블

### 1. user_mail
- **위치**: `2024_12_26_074747_create_user_mail_table.php`
- **목적**: 이메일 발송 이력
- **주요 필드**:
  - `user_id`: 수신자 ID
  - `subject`: 제목
  - `body`: 내용
  - `type`: 메일 유형
  - `sent_at`: 발송 시간
  - `read_at`: 읽은 시간
  - `status`: 발송 상태

### 2. user_mail_label
- **위치**: `2024_12_26_074747_create_user_mail_label_table.php`
- **목적**: 이메일 라벨/카테고리
- **주요 필드**:
  - `label_name`: 라벨명
  - `color`: 라벨 색상
  - `icon`: 라벨 아이콘
  - `priority`: 우선순위

### 3. user_messages
- **위치**: `2024_12_12_082842_create_user_messages_table.php`
- **목적**: 시스템 메시지/알림
- **주요 필드**:
  - `user_id`: 수신자 ID
  - `sender_id`: 발신자 ID
  - `message_type`: 메시지 유형
  - `title`: 제목
  - `content`: 내용
  - `is_read`: 읽음 여부
  - `priority`: 우선순위

### 4. user_review
- **위치**: `2024_12_26_082842_create_user_review_table.php`
- **목적**: 사용자 리뷰/피드백
- **주요 필드**:
  - `user_id`: 작성자 ID
  - `target_type`: 대상 유형
  - `target_id`: 대상 ID
  - `rating`: 평점
  - `review_text`: 리뷰 내용
  - `status`: 상태 (승인/대기/거부)

## 이메일 시스템

### 이메일 유형
- **transactional**: 거래 관련 (주문 확인, 결제 완료)
- **notification**: 알림 (비밀번호 변경, 로그인 알림)
- **marketing**: 마케팅 (프로모션, 뉴스레터)
- **system**: 시스템 (유지보수, 정책 변경)

### 이메일 템플릿
```
회원가입 환영
- 템플릿 ID: welcome_email
- 변수: {{name}}, {{email}}, {{verify_link}}
- 발송 시점: 가입 직후

비밀번호 재설정
- 템플릿 ID: password_reset
- 변수: {{name}}, {{reset_link}}, {{expires}}
- 발송 시점: 재설정 요청 시

휴면 계정 안내
- 템플릿 ID: dormant_notice
- 변수: {{name}}, {{last_login}}, {{dormant_date}}
- 발송 시점: 휴면 30일 전
```

### 발송 정책
- **일일 발송 제한**: 사용자당 50통
- **대량 발송**: 배치 처리 (시간당 1000통)
- **재발송**: 실패 시 3회 재시도
- **수신 거부**: 옵트아웃 링크 필수

## 메시지 시스템

### 메시지 우선순위
- **urgent**: 긴급 (즉시 푸시 알림)
- **high**: 높음 (1시간 내 전송)
- **normal**: 보통 (당일 전송)
- **low**: 낮음 (배치 전송)

### 메시지 채널
- **in-app**: 앱 내 알림
- **push**: 푸시 알림
- **email**: 이메일 전송
- **sms**: SMS 전송

### 읽음 처리
```php
// 메시지 읽음 처리
UPDATE user_messages
SET is_read = true,
    read_at = NOW()
WHERE id = ? AND user_id = ?
```

## 알림 설정

### 사용자별 설정
- 이메일 수신 동의
- 푸시 알림 설정
- SMS 수신 동의
- 마케팅 정보 수신

### 알림 그룹
```
계정 관련
├── 로그인 알림
├── 비밀번호 변경
└── 보안 경고

거래 관련
├── 주문 확인
├── 결제 완료
└── 배송 상태

커뮤니티
├── 댓글 알림
├── 좋아요 알림
└── 팔로우 알림
```

## 리뷰 관리

### 리뷰 유형
- **product**: 상품 리뷰
- **service**: 서비스 리뷰
- **user**: 사용자 평가
- **content**: 콘텐츠 평가

### 리뷰 모더레이션
- 자동 필터링 (욕설, 스팸)
- 수동 검토 (신고된 리뷰)
- 리뷰 승인/거부
- 리뷰어 보상 시스템

## 커뮤니케이션 통계

### 이메일 통계
- 발송률
- 오픈률
- 클릭률
- 수신거부률

### 메시지 통계
- 전송 성공률
- 읽음률
- 응답률
- 채널별 효과

### 리뷰 통계
- 평균 평점
- 리뷰 작성률
- 카테고리별 만족도

## 자동화 시나리오

### 웰컴 시리즈
```
Day 0: 환영 이메일
Day 1: 시작하기 가이드
Day 3: 주요 기능 안내
Day 7: 피드백 요청
```

### 리텐션 캠페인
```
7일 미접속: 리마인더 메시지
30일 미접속: 특별 혜택 제공
90일 미접속: 휴면 예고
```

### 생일 축하
```
생일 당일: 축하 메시지
생일 쿠폰 발행
특별 혜택 안내
```