# 로그인 기능 테스트 시나리오

## 📋 설정별 상세 테스트 항목표

### 테스트 번호 체계
- **TC-XXXX**: Test Case 번호
- **Config**: 설정 항목
- **Expected**: 예상 결과
- **Priority**: P0(필수) / P1(중요) / P2(권장) / P3(선택)

---

## 1. 인증 시스템 활성화 테스트

| TC # | Config | 값 | 테스트 항목 | 예상 결과 | Priority |
|------|--------|-----|----------|----------|----------|
| TC-0001 | `AUTH_ENABLE` | `true` | /login 접속 | 로그인 폼 표시 | P0 |
| TC-0002 | `AUTH_ENABLE` | `false` | /login 접속 | "시스템 유지보수 중" 메시지 | P1 |
| TC-0003 | `LOGIN_ENABLE` | `true` | /login 접속 | 로그인 폼 표시 | P0 |
| TC-0004 | `LOGIN_ENABLE` | `false` | /login 접속 | 비활성화 화면 표시 | P1 |
| TC-0005 | `AUTH_MAINTENANCE` | `true` | /login 접속 | 유지보수 화면 표시 | P2 |
| TC-0006 | `AUTH_MAINTENANCE` | `true` + 허용 IP | 허용 IP에서 접속 | 정상 로그인 가능 | P2 |

---

## 2. 인증 방식 테스트

### 2.1 세션 기반 인증

| TC # | Config | 테스트 항목 | 확인 사항 | Expected | Priority |
|------|--------|----------|---------|----------|----------|
| TC-0101 | `AUTH_METHOD=session` | 로그인 성공 | `Auth::login()` 호출됨 | ✅ 세션 생성 | P0 |
| TC-0102 | `AUTH_METHOD=session` | 쿠키 확인 | `laravel_session` 쿠키 존재 | ✅ 쿠키 저장됨 | P0 |
| TC-0103 | `AUTH_METHOD=session` | Remember Me 체크 | remember_token 생성 | ✅ 장기 로그인 | P1 |
| TC-0104 | `AUTH_METHOD=session` | 세션 만료 (120분) | 자동 로그아웃 | ✅ /login 리다이렉트 | P1 |
| TC-0105 | `AUTH_METHOD=session` | /home 접속 | auth 미들웨어 통과 | ✅ 페이지 표시 | P0 |

### 2.2 JWT 토큰 인증

| TC # | Config | 테스트 항목 | 확인 사항 | Expected | Priority |
|------|--------|----------|---------|----------|----------|
| TC-0201 | `AUTH_METHOD=jwt` | 로그인 성공 | `generateTokenPair()` 호출됨 | ✅ JWT 토큰 생성 | P0 |
| TC-0202 | `AUTH_METHOD=jwt` | 쿠키 확인 | `access_token` 쿠키 존재 | ✅ 60분 만료 | P0 |
| TC-0203 | `AUTH_METHOD=jwt` | 쿠키 확인 | `refresh_token` 쿠키 존재 | ✅ 30일 만료 | P0 |
| TC-0204 | `AUTH_METHOD=jwt` | /home 접속 | jwt.auth 미들웨어 통과 | ✅ 토큰 검증 성공 | P0 |
| TC-0205 | `AUTH_METHOD=jwt` | API 요청 (JSON) | JSON 응답 | ✅ tokens 객체 반환 | P1 |
| TC-0206 | `AUTH_METHOD=jwt` | 웹 요청 (HTML) | 리다이렉트 + 쿠키 | ✅ /home 이동 | P0 |
| TC-0207 | `AUTH_METHOD=jwt` | 만료된 토큰 | /home 접속 시도 | ❌ /login 리다이렉트 | P1 |
| TC-0208 | `AUTH_METHOD=jwt` | 잘못된 토큰 | /home 접속 시도 | ❌ "유효하지 않은 토큰" | P1 |

---

## 3. 계정 잠금 테스트

### 3.1 단계별 잠금

| TC # | Config | 실패 횟수 | 예상 결과 | 잠금 시간 | Priority |
|------|--------|---------|---------|---------|----------|
| TC-0301 | `LOCKOUT_ENABLE=true` | 1회 | 정상 에러 | - | P0 |
| TC-0302 | `LOCKOUT_ENABLE=true` | 4회 | 정상 에러 | - | P0 |
| TC-0303 | `LOCKOUT_ENABLE=true` | 5회 | ⚠️ 1단계 잠금 | 15분 | P0 |
| TC-0304 | `LOCKOUT_ENABLE=true` | 10회 | ⚠️ 2단계 잠금 | 60분 | P1 |
| TC-0305 | `LOCKOUT_ENABLE=true` | 15회 | 🔒 3단계 영구 잠금 | 영구 | P1 |
| TC-0306 | `LOCKOUT_ENABLE=false` | 100회 | 정상 에러 (잠금 없음) | - | P2 |

### 3.2 잠금 해제

| TC # | 테스트 항목 | 예상 결과 | Priority |
|------|----------|----------|----------|
| TC-0311 | 15분 경과 후 로그인 (1단계) | ✅ 잠금 해제, 정상 로그인 | P0 |
| TC-0312 | 60분 경과 후 로그인 (2단계) | ✅ 잠금 해제, 정상 로그인 | P1 |
| TC-0313 | 영구 잠금 후 로그인 (3단계) | ❌ 관리자 해제 필요 | P1 |
| TC-0314 | 성공 로그인 | 실패 횟수 0으로 초기화 | P0 |

### 3.3 시간 윈도우

| TC # | 테스트 항목 | 예상 결과 | Priority |
|------|----------|----------|----------|
| TC-0321 | 60분 내 5회 실패 | ⚠️ 잠금 | P1 |
| TC-0322 | 61분 내 5회 실패 (분산) | 정상 에러 (윈도우 리셋) | P2 |

---

## 4. 블랙리스트 테스트

| TC # | Config | 테스트 항목 | 예상 결과 | Priority |
|------|--------|----------|----------|----------|
| TC-0401 | `blacklist.enable=true` | 블랙리스트 이메일 로그인 | ❌ "차단된 이메일" | P1 |
| TC-0402 | `blacklist.enable=true` | 블랙리스트 IP 로그인 | ❌ "차단된 IP 주소" | P1 |
| TC-0403 | `auto_block_attempts=10` | 10회 실패 | 자동 블랙리스트 등록 | P1 |
| TC-0404 | `block_duration=1440` | 24시간 경과 | 자동 차단 해제 | P2 |
| TC-0405 | `blacklist.enable=false` | 블랙리스트 이메일 로그인 | ✅ 정상 로그인 | P2 |

---

## 5. 계정 상태 테스트

| TC # | 계정 상태 | 테스트 항목 | 예상 결과 | Priority |
|------|---------|----------|----------|----------|
| TC-0501 | `status=active` | 로그인 | ✅ 성공 | P0 |
| TC-0502 | `status=blocked` | 로그인 | ❌ "차단된 계정" + 차단 화면 | P0 |
| TC-0503 | `status=inactive` | 로그인 | ❌ "비활성화된 계정" | P0 |
| TC-0504 | `status=pending` | 로그인 | ❌ "승인 대기 중" + 승인 화면 | P1 |
| TC-0505 | `deleted_at != null` | 로그인 | ❌ "삭제된 계정" | P0 |
| TC-0506 | `email_verified_at=null` | 로그인 | ⚠️ 이메일 인증 안내 | P1 |
| TC-0507 | `last_login_at < 365일 전` | 로그인 (휴면) | ⚠️ 휴면 해제 화면 | P2 |

---

## 6. 비밀번호 검증 테스트

| TC # | 테스트 항목 | 입력값 | 예상 결과 | Priority |
|------|----------|--------|----------|----------|
| TC-0601 | 올바른 비밀번호 | `Password123!` | ✅ 로그인 성공 | P0 |
| TC-0602 | 틀린 비밀번호 | `WrongPass123!` | ❌ "이메일 또는 비밀번호 불일치" | P0 |
| TC-0603 | 비밀번호 미입력 | ` ` | ❌ "비밀번호를 입력해주세요" | P0 |
| TC-0604 | 만료된 비밀번호 (90일) | 올바른 비밀번호 | ⚠️ 비밀번호 변경 화면 | P2 |

---

## 7. 이메일 검증 테스트

| TC # | 테스트 항목 | 입력값 | 예상 결과 | Priority |
|------|----------|--------|----------|----------|
| TC-0701 | 올바른 이메일 | `user@example.com` | ✅ 로그인 처리 | P0 |
| TC-0702 | 잘못된 형식 | `invalid-email` | ❌ "올바른 이메일 형식이 아닙니다" | P0 |
| TC-0703 | 이메일 미입력 | ` ` | ❌ "이메일을 입력해주세요" | P0 |
| TC-0704 | 존재하지 않는 이메일 | `none@example.com` | ❌ "이메일 또는 비밀번호 불일치" | P0 |

---

## 8. 2단계 인증 (2FA) 테스트

| TC # | Config | 테스트 항목 | 예상 결과 | Priority |
|------|--------|----------|----------|----------|
| TC-0801 | `TWO_FACTOR_ENABLE=true` | 로그인 성공 | 2FA 코드 입력 화면 | P2 |
| TC-0802 | `TWO_FACTOR_ENABLE=true` | 이메일 방식 | 6자리 코드 이메일 발송 | P2 |
| TC-0803 | `TWO_FACTOR_ENABLE=true` | SMS 방식 | 6자리 코드 SMS 발송 | P2 |
| TC-0804 | `TWO_FACTOR_ENABLE=true` | OTP 앱 | Authenticator 코드 검증 | P2 |
| TC-0805 | `TWO_FACTOR_ENABLE=true` | 올바른 코드 입력 | ✅ 홈으로 이동 | P2 |
| TC-0806 | `TWO_FACTOR_ENABLE=true` | 틀린 코드 입력 | ❌ "잘못된 코드" | P2 |
| TC-0807 | `TWO_FACTOR_ENABLE=true` | 5분 경과 후 입력 | ❌ "코드 만료" | P2 |
| TC-0808 | `TWO_FACTOR_ENABLE=true` | 복구 코드 사용 | ✅ 홈으로 이동 | P2 |
| TC-0809 | `TWO_FACTOR_ENABLE=false` | 로그인 성공 | 즉시 홈으로 이동 | P0 |

---

## 9. 소셜 로그인 테스트

| TC # | Provider | Config | 테스트 항목 | 예상 결과 | Priority |
|------|----------|--------|----------|----------|----------|
| TC-0901 | Google | `GOOGLE_AUTH_ENABLE=true` | Google 버튼 클릭 | OAuth 리다이렉트 | P2 |
| TC-0902 | Google | `GOOGLE_AUTH_ENABLE=true` | OAuth 인증 성공 | ✅ 로그인 + /home 이동 | P2 |
| TC-0903 | Facebook | `FACEBOOK_AUTH_ENABLE=true` | Facebook 버튼 클릭 | OAuth 리다이렉트 | P2 |
| TC-0904 | GitHub | `GITHUB_AUTH_ENABLE=true` | GitHub 버튼 클릭 | OAuth 리다이렉트 | P2 |
| TC-0905 | Kakao | `KAKAO_AUTH_ENABLE=true` | Kakao 버튼 클릭 | OAuth 리다이렉트 | P2 |
| TC-0906 | Naver | `NAVER_AUTH_ENABLE=true` | Naver 버튼 클릭 | OAuth 리다이렉트 | P2 |
| TC-0907 | All | `SOCIAL_AUTH_ENABLE=false` | 로그인 화면 확인 | 소셜 버튼 숨김 | P2 |
| TC-0908 | Google | 신규 사용자 | OAuth 인증 성공 | 자동 회원가입 + 로그인 | P2 |
| TC-0909 | Google | 기존 사용자 | OAuth 인증 성공 | 기존 계정 로그인 | P2 |

---

## 10. reCAPTCHA 테스트

| TC # | Config | Version | 테스트 항목 | 예상 결과 | Priority |
|------|--------|---------|----------|----------|----------|
| TC-1001 | `RECAPTCHA_ENABLE=true` | `v2` | 로그인 화면 | 체크박스 표시 | P2 |
| TC-1002 | `RECAPTCHA_ENABLE=true` | `v2` | 체크박스 선택 후 로그인 | ✅ 성공 | P2 |
| TC-1003 | `RECAPTCHA_ENABLE=true` | `v2` | 체크박스 미선택 | ❌ "보안 검증 필요" | P2 |
| TC-1004 | `RECAPTCHA_ENABLE=true` | `v3` | 로그인 화면 | 백그라운드 처리 | P2 |
| TC-1005 | `RECAPTCHA_ENABLE=true` | `v3` | 점수 0.5 이상 | ✅ 성공 | P2 |
| TC-1006 | `RECAPTCHA_ENABLE=true` | `v3` | 점수 0.5 미만 | ❌ "봇 의심" | P2 |
| TC-1007 | `RECAPTCHA_ENABLE=false` | - | 로그인 화면 | reCAPTCHA 숨김 | P0 |

---

## 11. 리다이렉트 테스트

| TC # | 시나리오 | Config | 예상 결과 | Priority |
|------|---------|--------|----------|----------|
| TC-1101 | 직접 로그인 | `redirect_after_login=/home` | /home 이동 | P0 |
| TC-1102 | /dashboard 접근 후 로그인 | intended URL | /dashboard 이동 | P1 |
| TC-1103 | /admin/users 접근 후 로그인 | intended URL | /admin/users 이동 | P1 |
| TC-1104 | 로그아웃 | `redirect_after_logout=/login` | /login 이동 | P0 |
| TC-1105 | 인증된 사용자가 /login 접근 | - | / 이동 (루트) | P1 |

---

## 12. 입력값 검증 테스트

| TC # | 필드 | 입력값 | 예상 결과 | Priority |
|------|------|--------|----------|----------|
| TC-1201 | 이메일 | `valid@example.com` | ✅ 통과 | P0 |
| TC-1202 | 이메일 | `invalid` | ❌ "올바른 이메일 형식" | P0 |
| TC-1203 | 이메일 | ` ` (공백) | ❌ "이메일 필수" | P0 |
| TC-1204 | 비밀번호 | `MyPass123!` | ✅ 통과 | P0 |
| TC-1205 | 비밀번호 | ` ` (공백) | ❌ "비밀번호 필수" | P0 |
| TC-1206 | Remember | 체크됨 | remember_token 생성 | P1 |
| TC-1207 | Remember | 체크 안 됨 | remember_token 없음 | P1 |

---

## 13. 샤딩 테스트

| TC # | Config | 테스트 항목 | 예상 결과 | Priority |
|------|--------|----------|----------|----------|
| TC-1301 | `SHARDING_ENABLE=true` | 사용자 조회 | ShardingService 사용 | P3 |
| TC-1302 | `SHARDING_ENABLE=true` | UUID 기반 조회 | 16개 샤드 중 1개 선택 | P3 |
| TC-1303 | `SHARDING_ENABLE=true` | 이메일 인덱스 | 인덱스 테이블 사용 | P3 |
| TC-1304 | `SHARDING_ENABLE=false` | 사용자 조회 | User 모델 직접 사용 | P0 |
| TC-1305 | `SHARDING_ENABLE=false` | ID 기반 조회 | 단일 DB 조회 | P0 |

---

## 14. 로그 기록 테스트

| TC # | 테스트 항목 | 확인 테이블 | 예상 데이터 | Priority |
|------|----------|-----------|-----------|----------|
| TC-1401 | 로그인 성공 | `auth_login_attempts` | successful=true | P1 |
| TC-1402 | 로그인 실패 | `auth_login_attempts` | successful=false | P1 |
| TC-1403 | IP 주소 기록 | `auth_login_attempts` | ip_address 저장 | P1 |
| TC-1404 | User Agent 기록 | `auth_login_attempts` | user_agent 저장 | P2 |
| TC-1405 | 실패 사유 기록 | `auth_login_attempts` | failure_reason 저장 | P1 |
| TC-1406 | JWT 토큰 기록 | `jwt_tokens` | token_id, expires_at | P2 |

---

## 15. Remember Me 테스트

| TC # | 테스트 항목 | 예상 결과 | Priority |
|------|----------|----------|----------|
| TC-1501 | Remember 체크 + 로그인 | remember_token 생성 | P1 |
| TC-1502 | 브라우저 종료 후 재접속 | 자동 로그인 | P1 |
| TC-1503 | Remember 미체크 + 로그인 | 세션 쿠키만 생성 | P1 |
| TC-1504 | 브라우저 종료 후 재접속 | 로그아웃됨 | P1 |

---

## 16. 세션 관리 테스트

| TC # | Config | 테스트 항목 | 예상 결과 | Priority |
|------|--------|----------|----------|----------|
| TC-1601 | `max_sessions=3` | 4번째 디바이스 로그인 | 첫 번째 세션 종료 | P2 |
| TC-1602 | `session_lifetime=120` | 120분 경과 | 자동 로그아웃 | P1 |
| TC-1603 | `session_lifetime=120` | 활동 중 | 세션 연장 | P1 |

---

## 17. 알림 테스트

| TC # | Config | 테스트 항목 | 예상 결과 | Priority |
|------|--------|----------|----------|----------|
| TC-1701 | `new_device_login=true` | 새 디바이스 로그인 | 이메일 알림 발송 | P2 |
| TC-1702 | `suspicious_activity=true` | 비정상 패턴 감지 | 이메일 알림 발송 | P2 |
| TC-1703 | `password_changed=true` | 비밀번호 변경 | 이메일 알림 발송 | P2 |

---

## 18. API 응답 테스트

### 18.1 JWT 모드 API 응답

| TC # | 요청 타입 | 상태 | 예상 응답 | Priority |
|------|---------|------|----------|----------|
| TC-1801 | JSON 요청 | 성공 | `{"success":true, "tokens":{...}}` | P1 |
| TC-1802 | JSON 요청 | 실패 | `{"success":false, "message":"..."}` | P1 |
| TC-1803 | JSON 요청 | 잠금 | `{"success":false, "code":"ACCOUNT_LOCKED"}` | P2 |

---

## 19. UI 표시 테스트

| TC # | 테스트 항목 | 예상 결과 | Priority |
|------|----------|----------|----------|
| TC-1901 | 로그인 성공 메시지 | "로그인되었습니다" alert | P0 |
| TC-1902 | 로그인 실패 메시지 | 빨간색 에러 메시지 | P0 |
| TC-1903 | 이메일 입력값 유지 | old('email') 표시 | P1 |
| TC-1904 | 잠금 메시지 | "N분간 로그인 제한" | P1 |
| TC-1905 | 반응형 디자인 | 모바일/태블릿/데스크탑 | P1 |

---

## 20. 통합 시나리오 테스트

### 시나리오 A: 정상 로그인 (JWT)
```
설정: AUTH_METHOD=jwt, TWO_FACTOR_ENABLE=false
1. /login 접속
2. 이메일: user@example.com
3. 비밀번호: Password123!
4. 로그인 버튼 클릭
5. ✅ JWT 토큰 쿠키 저장
6. ✅ /home 리다이렉트
7. ✅ jwt.auth 미들웨어 통과
```

### 시나리오 B: 계정 잠금
```
설정: LOCKOUT_ENABLE=true
1. /login 접속
2. 틀린 비밀번호로 5회 시도
3. ⚠️ "15분간 로그인 제한" 메시지
4. 15분 대기
5. 올바른 비밀번호로 로그인
6. ✅ 잠금 해제, 로그인 성공
```

### 시나리오 C: 2FA + 소셜 로그인
```
설정: TWO_FACTOR_ENABLE=true, GOOGLE_AUTH_ENABLE=true
1. Google 버튼 클릭
2. Google OAuth 인증
3. ✅ 계정 연동 확인
4. ✅ 2FA 코드 입력 화면
5. 이메일에서 코드 확인
6. 코드 입력
7. ✅ /home 이동
```

### 시나리오 D: 휴면 해제
```
설정: DORMANT_ENABLE=true
1. 365일 미접속 계정으로 로그인
2. ⚠️ 휴면 해제 화면 표시
3. 본인 인증 진행
4. ✅ 휴면 해제
5. ✅ /home 이동
```

### 시나리오 E: 이메일 미인증 + 승인 대기
```
설정: REGISTER_REQUIRE_EMAIL=true, REGISTER_REQUIRE_APPROVAL=true
1. 회원가입 완료 (status=pending, email_verified_at=null)
2. 로그인 시도
3. ⚠️ "관리자 승인 대기 중" 메시지
4. 관리자가 승인 (status=active)
5. 다시 로그인 시도
6. ⚠️ "이메일 인증 필요" 메시지
7. 이메일 인증 완료
8. 다시 로그인 시도
9. ✅ /home 이동
```

---

## 🎯 테스트 커버리지 목표

| 카테고리 | 필수 | 중요 | 권장 | 선택 | 총 |
|---------|-----|-----|-----|-----|-----|
| 기본 로그인 | 12 | 5 | 3 | 2 | 22 |
| 인증 방식 | 6 | 8 | 2 | 0 | 16 |
| 보안 | 8 | 15 | 8 | 4 | 35 |
| 계정 상태 | 5 | 4 | 2 | 0 | 11 |
| 2FA | 0 | 0 | 9 | 0 | 9 |
| 소셜 로그인 | 0 | 0 | 9 | 0 | 9 |
| 기타 | 5 | 8 | 7 | 5 | 25 |
| **합계** | **36** | **40** | **40** | **11** | **127** |

**최소 테스트**: 36개 (P0)  
**권장 테스트**: 76개 (P0 + P1)  
**전체 테스트**: 127개 (All)
