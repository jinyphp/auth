# 로그인/회원가입 TDD 테스트 결과

## 📅 테스트 정보
- **테스트 일시**: 2025-10-05 01:19
- **테스트 환경**: Laravel 12, SQLite, JWT 인증
- **테스트 범위**: 로그인, 회원가입, 계정 상태, 보안 기능

---

## ✅ 테스트 사용자 준비 완료

| 이메일 | 이름 | 상태 | 인증 | 비밀번호 | 용도 |
|--------|------|------|------|---------|------|
| test-active@test.com | 활성사용자 | `active` | ✅ | Password123! | 정상 로그인 |
| test-blocked@test.com | 차단사용자 | `blocked` | ✅ | Password123! | 차단 테스트 |
| test-pending@test.com | 승인대기 | `pending` | ✅ | Password123! | 승인 대기 |
| test-inactive@test.com | 비활성계정 | `inactive` | ✅ | Password123! | 비활성화 |
| test-unverified@test.com | 미인증사용자 | `active` | ❌ | Password123! | 미인증 |

---

## 📊 Phase 1: 기본 로그인 테스트 (P0)

### ✅ TC-001: 정상 로그인 (Active + Verified)

**사용자**: `test-active@test.com`

**실행 명령어**:
```bash
php artisan auth:user-info test-active@test.com
```

**테스트 절차**:
1. ✅ http://localhost:8000/login 접속
2. ✅ 로그인 폼 표시 확인
3. ✅ 이메일 입력: test-active@test.com
4. ✅ 비밀번호 입력: Password123!
5. ✅ 로그인 버튼 클릭

**예상 결과**:
- [x] JWT 토큰 생성 및 쿠키 저장
- [x] /home 페이지로 리다이렉트
- [x] jwt.auth 미들웨어 통과
- [x] 대시보드 페이지 표시

**실제 결과**: ⏳ 수동 테스트 필요

---

### ✅ TC-002: 차단된 계정 로그인 (Blocked)

**사용자**: `test-blocked@test.com`

**테스트 절차**:
1. ⏳ http://localhost:8000/login 접속
2. ⏳ 이메일 입력: test-blocked@test.com
3. ⏳ 비밀번호 입력: Password123!
4. ⏳ 로그인 버튼 클릭

**예상 결과**:
- [x] "차단된 계정입니다" 에러 메시지
- [x] 로그인 실패
- [x] 차단 화면 표시 (설정된 경우)

**실제 결과**: ⏳ 수동 테스트 필요

---

### ✅ TC-003: 승인 대기 계정 로그인 (Pending)

**사용자**: `test-pending@test.com`

**테스트 절차**:
1. ⏳ 이메일 입력: test-pending@test.com
2. ⏳ 비밀번호 입력: Password123!
3. ⏳ 로그인 버튼 클릭

**예상 결과**:
- [x] "관리자 승인 대기 중" 메시지
- [x] 로그인 실패
- [x] 승인 대기 화면 표시

**승인 후 재테스트**:
```bash
php artisan auth:user-status test-pending@test.com active
# 다시 로그인 → ✅ 성공 예상
```

**실제 결과**: ⏳ 수동 테스트 필요

---

### ✅ TC-004: 비활성화 계정 로그인 (Inactive)

**사용자**: `test-inactive@test.com`

**테스트 절차**:
1. ⏳ 이메일 입력: test-inactive@test.com
2. ⏳ 로그인 시도

**예상 결과**:
- [x] "비활성화된 계정입니다" 메시지
- [x] 로그인 실패

**실제 결과**: ⏳ 수동 테스트 필요

---

### ✅ TC-005: 이메일 미인증 계정 로그인 (Unverified)

**사용자**: `test-unverified@test.com`

**테스트 절차**:
1. ⏳ 이메일 입력: test-unverified@test.com
2. ⏳ 로그인 시도

**예상 결과**:
- [x] "이메일 인증이 필요합니다" 메시지
- [x] 인증 안내 화면 표시
- [x] 재발송 링크 표시

**인증 후 재테스트**:
```bash
php artisan auth:email-verify test-unverified@test.com
# 다시 로그인 → ✅ 성공 예상
```

**실제 결과**: ⏳ 수동 테스트 필요

---

## 📊 Phase 2: 계정 잠금 테스트 (P0-P1)

### ✅ TC-101: 5회 실패 시 1단계 잠금

**준비**:
```bash
php artisan auth:user-create locktest@test.com --name="잠금테스트"
php artisan auth:email-verify locktest@test.com
```

**테스트 절차**:
1. ⏳ 이메일: locktest@test.com
2. ⏳ 비밀번호: WrongPassword (틀린 비밀번호)
3. ⏳ 5회 연속 시도

**예상 결과**:
- [x] 1-4회: "이메일 또는 비밀번호 불일치"
- [x] 5회째: "5회 이상 비밀번호를 잘못 입력하여 15분간 로그인이 제한됩니다"
- [x] 잠금 레벨 1 적용

**검증**:
```bash
php artisan auth:user-info locktest@test.com
# 예상: 🔒 계정 잠금 정보, 실패 횟수: 5회
```

**해제 테스트**:
```bash
php artisan auth:lockout-reset locktest@test.com
# 다시 올바른 비밀번호로 로그인 → ✅ 성공 예상
```

**실제 결과**: ⏳ 수동 테스트 필요

---

## 📊 Phase 3: 회원가입 테스트 (P0)

### ✅ TC-301: 정상 회원가입

**테스트 절차**:
1. ⏳ http://localhost:8000/register 접속
2. ⏳ 이름: 신규회원
3. ⏳ 이메일: newuser@test.com
4. ⏳ 비밀번호: Password123!
5. ⏳ 비밀번호 확인: Password123!
6. ⏳ 약관 동의 체크
7. ⏳ 회원가입 버튼 클릭

**예상 결과**:
- [x] 계정 생성 성공
- [x] users 테이블에 저장
- [x] user_profiles 테이블에 저장
- [x] "회원가입이 완료되었습니다" 메시지
- [x] /login 리다이렉트 (또는 이메일 인증 안내)

**검증**:
```bash
php artisan auth:user-info newuser@test.com
# 계정 정보 표시되면 성공
```

**실제 결과**: ⏳ 수동 테스트 필요

---

### ✅ TC-302: 중복 이메일 회원가입

**테스트 절차**:
1. ⏳ http://localhost:8000/register 접속
2. ⏳ 이메일: test-active@test.com (기존 이메일)
3. ⏳ 나머지 정보 입력
4. ⏳ 회원가입 버튼 클릭

**예상 결과**:
- [x] "이미 사용 중인 이메일입니다" 에러
- [x] 폼 유지 (입력값 유지)
- [x] 계정 생성 안 됨

**실제 결과**: ⏳ 수동 테스트 필요

---

### ✅ TC-303: 약관 미동의 회원가입

**테스트 절차**:
1. ⏳ http://localhost:8000/register 접속
2. ⏳ 모든 정보 입력
3. ⏳ 약관 체크 안 함
4. ⏳ 회원가입 버튼 클릭

**예상 결과**:
- [x] "필수 약관에 동의해주세요" 에러
- [x] 계정 생성 안 됨

**실제 결과**: ⏳ 수동 테스트 필요

---

## 📊 테스트 진행 상황

### 준비 완료 항목
- [x] 콘솔 명령어 8개 생성
- [x] 테스트 사용자 5명 생성
- [x] 계정 상태 설정 완료
- [x] 이메일 인증 상태 설정 완료
- [x] 테스트 체크리스트 작성
- [x] 설정 파일 env() 제거

### 수동 테스트 필요 항목 (브라우저)
- [ ] TC-001: 정상 로그인
- [ ] TC-002: 차단 계정
- [ ] TC-003: 승인 대기
- [ ] TC-004: 비활성화
- [ ] TC-005: 미인증
- [ ] TC-101: 계정 잠금
- [ ] TC-301: 정상 회원가입
- [ ] TC-302: 중복 이메일
- [ ] TC-303: 약관 미동의

---

## 🎯 다음 단계

### 브라우저 테스트 실행
1. 개발 서버 실행: `php artisan serve`
2. http://localhost:8000/login 접속
3. 각 테스트 케이스 순서대로 실행
4. 결과를 이 문서에 기록

### 자동화 테스트 작성 (향후)
- Feature 테스트 작성 (`tests/Feature/Auth/`)
- 로그인 테스트
- 회원가입 테스트
- 계정 상태 테스트
- PHPUnit 실행

---

## 📝 테스트 메모

### 환경 설정
- `AUTH_METHOD`: jwt
- `LOCKOUT_ENABLE`: true
- `SHARDING_ENABLE`: false (테스트용)
- `TWO_FACTOR_ENABLE`: false
- `SOCIAL_AUTH_ENABLE`: false

### 알려진 이슈
- UserCreateCommand의 `--verified` 옵션이 작동하지 않음
  - 해결: `auth:email-verify` 명령어로 수동 인증
- 테이블 컬럼명: `status` → `account_status`
  - 해결: 모든 명령어에서 `account_status` 사용

---

## 🔄 테스트 반복 실행

### 빠른 리셋
```bash
# 1. 테스트 데이터 삭제
php artisan tinker --execute="\App\Models\User::where('email', 'like', '%@test.com')->delete();"

# 2. 잠금 해제
php artisan auth:lockout-reset "" --all

# 3. 세션 정리
php artisan auth:session-clear --expired

# 4. 캐시 클리어
php artisan cache:clear
php artisan config:clear
php artisan view:clear
```

### 재생성
```bash
# 위의 "1단계: 테스트 사용자 생성" 스크립트 재실행
```
